#!/bin/bash

rustup target add aarch64-linux-android armv7-linux-androideabi i686-linux-android x86_64-apple-ios aarch64-apple-ios-sim aarch64-apple-ios armv7-apple-ios armv7s-apple-ios x86_64-apple-ios i386-apple-ios
cargo install cargo-lipo

TARGET_NAME="libwalletcore_crypto_bindgen.a"
cd bindgen/rust
CARGO_TARGET_DIR=../../build/local cargo build --release
CARGO_TARGET_DIR=../../build/local cargo build --target aarch64-linux-android --release
CARGO_TARGET_DIR=../../build/local cargo build --target i686-linux-android --release
CARGO_TARGET_DIR=../../build/local cargo build --target aarch64-apple-ios-sim --release
CARGO_TARGET_DIR=../../build/local cargo lipo --release
cbindgen --crate walletcore-crypto-bindgen --output ../../src/rust/bindgen/WalletCoreCryptoBindgen.h
cd -
mv build/local/release/${TARGET_NAME} build/local/lib/
